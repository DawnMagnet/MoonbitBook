# MoonBit 第二章 运行第一个 MoonBit 程序

## 2.1 配置 IDE

编辑器类似于记事本，可以理解为更加漂亮的记事本。编译器类似于一个翻译器，可以将 MoonBit 代码翻译成机器语言。IDE 就是集成开发环境（Integrated Development Environment），它将编辑器和编译器集成在一起，提供了一个完整的开发环境。

MoonBit 官方推荐了两种方法来配置开发环境：使用在线编程环境和本地安装 VSCode 编辑器。如果使用在线环境，是一个完整的 IDE，直接在浏览器中编写和运行代码即可；如果使用本地编辑器，则需要安装 VSCode 编辑器和 MoonBit 插件和 MoonBit 编译器。

### 2.1.0 在线编程环境

MoonBit 有一个非常好用的在线体验网站，如果是前期学习阶段，可以直接在上面进行编程练习。这个网站是一个在线的编程环境，可以让我们在浏览器中编写和运行 MoonBit 代码，而不需要安装任何软件。

[https://try.moonbitlang.cn/](https://try.moonbitlang.cn/)

![MoonBit在线使用网站](image/2/online.png)

在这个网站可以满足绝大多数 MoonBit 的学习需求。我们可以在上面编写代码、运行代码、查看输出结果等。这个网站还提供了很多示例代码，可以帮助我们更好地理解 MoonBit 的语法和用法。

### 2.1.1 安装 VSCode 编辑器

为了方便后续的编码任务，MoonBit 官方推荐使用 VSCode 作为编程工具。VSCode 是一个免费的开源代码编辑器，支持多种编程语言和插件。通过安装 MoonBit 插件，我们可以在 VSCode 中编写和运行 MoonBit 代码。

#### 2.1.1.1 在 Windows 上安装 VSCode

1. 下载并安装 VSCode：[VSCode 官网](https://code.visualstudio.com/)
2. 如果你使用的是 Windows 系统，可以在下载后点击 exe 文件进行安装。高于 Windows 10 的系统可以在终端里使用 winget 命令安装。

```bash
winget install -e --id Microsoft.VisualStudioCode
```

#### 2.1.1.1 在 Linux 上安装 VSCode

![Linux安装包下载页面](image/2/linux-download.png)

如果你使用的是 Debian/Ubuntu/Linux Mint 等 Linux 系统，可以下载 deb 文件进行安装。

```bash
sudo apt install ./<file>.deb
```

如果使用的是基于 RHEL 的系统（如 CentOS、Fedora、AlmaLinux 等），可以下载 rpm 文件进行安装。

```bash
 sudo dnf install ./<file>.rpm
```

其他操作系统可以参考 _VSCode 官网_<https://code.visualstudio.com/docs/setup/setup-overview> 进行安装。

#### 2.1.2 安装 MoonBit 插件

安装完 VSCode 后，我们需要安装 MoonBit 插件。MoonBit 插件可以让我们在 VSCode 中编写和运行 MoonBit 代码。

1. 打开 VSCode，点击左侧的扩展图标（或按下 `Ctrl+Shift+X`）。
   ![12312](./image/2/side.png)

2. 在搜索栏输入 moonbit，并点击安装（Install），注意作者必须是 MoonBit
   ![image-20250505144044406](image/2/moonbit-plug.png)

   > （可选步骤）如果你希望 VSCode 的语言是中文，可以安装中文语言包，具体的操作方式与安装 MoonBit 插件一样，在搜索栏输入 chinese 并安装，注意作者必须得是 Microsoft（微软公司）
   > ![image-20250505144220720](image/2/chinese-plug.png)

3. 安装完成后，最好先重启一下 VSCode 以便插件生效。

## 2.1.3 安装 MoonBit 编译器

MoonBit 编译器是将 MoonBit 代码编译成机器语言的工具。
MoonBit 官方提供了多种安装方式，以下是常用的两种方式：

1. 如果你刚刚安装了 VSCode 以及 MoonBit 插件，可以直接使用插件提供的一键自动下载安装的方式，
   在 VSCode 中按下 `Ctrl+Shift+P`，输入 `moonbit`，找到 `MoonBit: Install Compiler`字样的内容，然后按下回车键即可。
   ![install-moonbit](image/2/install-moonbit.png)

2. 如果你是一个高级用户，不需要用 VSCode，可以直接在终端中使用命令行安装 MoonBit 编译器。MoonBit 官方提供了多种安装方式，以下是常用的两种方式：

   - 在 Linux&MacOS 使用 `curl` 命令下载并安装 MoonBit 编译器：

```bash
curl -fsSL https://cli.moonbitlang.cn/install/unix.sh | bash
```

- 在 Windows 上使用 `PowerShell` 命令下载并安装 MoonBit 编译器：

```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser; irm https://cli.moonbitlang.cn/install/powershell.ps1 | iex
```

这两种安装方式没有什么区别，都是将 MoonBit 编译器安装到系统中。安装完成后，可以在终端中输入 `moonbit --version` 来检查是否安装成功。（如果没有可以考虑注销用户重新登录）

## 2.2 编写第一个 MoonBit 程序

现在我们已经安装好了 MoonBit 的开发环境，可以开始编写第一个 MoonBit 程序了。我们将编写一个简单的程序，输出 "Hello, MoonBit!"。

如果使用在线环境，可以直接打开浏览器，进入 [MoonBit 在线编程环境](https://try.moonbitlang.cn/)。如果使用本地环境，可以在 VSCode 中打开一个新的空文件夹，作为新的工作区。

然后在文件列表中新建一个文件，命名为 `main.mbt`。

![新建文件](image/2/new-file.png)

在这个文件中输入以下代码：

```moonbit
fn main {
  println("Hello, Moonbit!");
}
```

点击运行按钮
![RUN](image/2/run.png)

或者你也可以打开终端，在其中输入以下命令来运行程序,这和你点击按钮是一样的效果：

![终端运行](image/2/terminal-run.png)

恭喜你，你已经成功编写并运行了第一个 MoonBit 程序！你应该能在输出区域看到 "Hello, MoonBit!" 的字样。

## 2.3 使用 `moon` 来管理工程

刚刚我们的例子是运行了一个单文件的简单的 MoonBit 程序，但在实际开发中，我们通常会有多个文件和更复杂的项目结构。MoonBit 提供了一个命令行工具 `moon` 来帮助我们管理这些项目。
`moon` 工具可以帮助我们创建、编译和运行 MoonBit 项目。它提供了一些常用的命令，可以让我们更方便地管理项目。

在当前目录下，可以使用`moon new <名称>`的命令来创建一个新的 MoonBit 项目。例如，我们可以创建一个名为 `my_project` 的项目：

```bash
moon new my_project
```

这个命令会在当前目录下创建一个名为 `my_project` 的文件夹，并在其中生成一些默认的文件和目录结构。你可以进入这个文件夹，查看里面的内容：

![my_project 目录结构](image/2/folder-struc.png)

> 在理解项目结构时，先无需理解语法，首先掌握项目的目录结构和文件的含义是非常重要的。下面我们来逐一介绍这些文件和目录。

在这个项目中，存在两个重要的部分，一个是库代码，一般成为 lib 或者 library，另一个是可执行代码，一般称为 bin 或者 binary，这个概念在任何编程语言里都有。

可执行程序的含义是一个需要被运行的程序，它通常包含一个入口函数（如 `main` 函数），运行它就会发生一些预期的行为，比如展示一个窗口，或者输出一些信息。而库代码则是一些可以被其他程序调用的函数或类，它们通常不包含入口函数，而是提供一些功能供其他程序使用。

总结一下，即可执行程序可以调用库实现更加高级的功能，库代码既可以被可执行程序调用，也可以被其他库调用。

#### 项目根目录

##### .gitignore

- 含义: 这个文件告诉 Git 版本控制系统在提交代码时应该忽略哪些文件和文件夹。

##### LICENSE

- 含义: 这是项目的开源许可证文件，默认使用 Apache-2.0 许可证。它规定了项目的使用、修改和分发的条款。

##### moon.mod.json

- 含义: 这是 MoonBit 项目的模块配置文件，定义了整个项目的元数据。
- 内容:
  - name: "username/hello" - 模块的名称，通常采用 用户名/项目名 的格式。
  - version: "0.1.0" - 项目的当前版本。
  - license: "Apache-2.0" - 项目的许可证类型。
  - source: "src" - 指定源代码位于 src 目录下。

##### README.md

- 含义: 项目的说明文档，通常包含项目的简介、如何安装和使用等信息。
- 内容: 目前只包含一行标题：# username/hello。

#### src/lib 目录 (库代码)

##### src/lib/moon.pkg.json

- 含义: 这是 lib 包的 MoonBit 包配置文件。
- 内容: 文件内容为空 {}，表示这是一个标准的库包，没有特殊的配置。

##### src/lib/hello.mbt

- 含义: 这是库的核心源文件，定义了一个公共函数。
- 内容:

```moonbit
pub fn hello() -> String {
    "Hello, world!"
}
```

代码定义了一个名为 hello 的公共函数 (pub fn)，该函数没有参数，返回一个 String 类型的值，其内容是 "Hello, world!"。

##### src/lib/hello_test.mbt

```moonbit
test "hello" {
  if @lib.hello() != "Hello, world!" {
    fail("@lib.hello() != \"Hello, world!\"")
  }
}
```

- 含义: 这是 hello 函数的测试文件。
- 内容:

```moonbit
test "hello" {
  if @lib.hello() != "Hello, world!" {
    fail("@lib.hello() != \"Hello, world!\"")
  }
}
```

代码定义了一个名为 "hello" 的测试用例。它调用 @lib.hello() 函数，并检查返回值是否等于 "Hello, world!"。如果不相等，测试将失败并报告错误信息。

#### src/main 目录 (可执行代码)

##### src/main/moon.pkg.json

- 含义: 这是 main 包的 MoonBit 包配置文件，定义了可执行程序的属性。
- 内容:
  - "is-main": true: 指定这个包是一个可执行程序（而不是一个库）。
  - "import": ["username/hello/lib"]: 声明该包依赖（导入）了 username/hello/lib 这个库包，以便使用其中定义的函数。

##### src/main/main.mbt

- 含义: 这是程序的主入口文件。
- 内容:

```moonbit
fn main {
    println(@lib.hello())
}
```

代码定义了 main 函数，这是程序的执行起点。它调用了从 lib 包导入的 hello 函数 (@lib.hello())，并使用 println 将其返回值 "Hello, world!" 打印到控制台。

根据上方的总结，我们可以看出，这个项目的结构是非常清晰的。`src/lib` 目录下存放的是库代码，`src/main` 目录下存放的是可执行代码。库代码可以被可执行代码调用，也可以被其他库调用。而可执行代码则是整个项目的入口点，负责调用库中的函数并输出结果。

在实际的工程中，库和可执行代码的分离可以让我们更好地组织代码，提高代码的复用性和可维护性。我们可以将一些通用的功能封装成库，然后在不同的项目中使用这些库，而不需要重复编写相同的代码。当然，你也可以创建一个纯粹的代码库，或者一个纯粹的可执行程序，具体取决于你的需求。

但对于库代码，测试是非常重要的。我们可以在 `src/lib` 目录下编写测试代码，确保库中的函数在各种情况下都能正常工作。测试代码通常以 `<文件名>_test.mbt` 结尾（注意必须存在对应的`<文件名>.mbt`），MoonBit 会自动识别并运行这些测试。

> 在学习阶段，你可以不使用工程结构，直接在单个文件中编写和测试代码。但是一旦你开始编写更复杂的程序，或者需要复用某些功能时，使用工程结构将会大大提高你的开发效率和代码质量。
